<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create invoice — Tradeautobill</title>
  <meta name="description" content="Build and send a professional invoice fast." />
  <meta property="og:title" content="Create invoice — Tradeautobill" />
  <meta property="og:description" content="Build and send a professional invoice fast." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0066FF"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --color-bg:#FFFFFF; --color-text:#111; --color-muted:#444;
      --color-accent:#0066FF; --color-border:#E6E6E6; --color-soft:#F7F9FF;
      --spacing:8px; --font-body:'Inter',sans-serif; --font-heading:'Space Grotesk',sans-serif;
      --radius:10px; --shadow:0 6px 24px rgba(0,0,0,0.06);
    }
    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;background:var(--color-bg);color:var(--color-text);font-family:var(--font-body);line-height:1.5}
    a{color:var(--color-accent);text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1140px;margin:0 auto;padding:0 16px}
    .sr-only{position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0)}
    .muted{color:#555}
    .small{font-size:.95rem}
    .tiny{font-size:.85rem}

    /* NAV */
    .nav{display:flex;justify-content:space-between;align-items:center;padding:16px 0}
    .logo{font-family:var(--font-heading);font-weight:700;font-size:1.25rem}
    .nav a.btn{padding:10px 16px;border:1px solid var(--color-border);border-radius:8px}

    /* COMMON */
    .btn{display:inline-flex;align-items:center;justify-content:center;font-weight:700;border:none;border-radius:10px;cursor:pointer}
    .btn-primary{background:var(--color-accent);color:#fff;padding:12px 16px}
    .btn-secondary{background:#fff;color:var(--color-text);padding:12px 16px;border:1px solid var(--color-border)}
    .btn-link{background:none;border:none;padding:0;color:var(--color-accent);cursor:pointer}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .card{border:1px solid var(--color-border);border-radius:12px;padding:18px;background:#fff;box-shadow:var(--shadow)}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .data{width:100%;border-collapse:collapse;border:1px solid var(--color-border)}
    .data th,.data td{padding:10px;border-top:1px solid var(--color-border);text-align:left}
    .num{text-align:right}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--color-border);font-size:.85rem}
    .max-w-md{max-width:560px;margin:0 auto}
    .py-10{padding:56px 0}
    .py-12{padding:64px 0}
    .py-16{padding:96px 0}

    /* FORMS */
    form input, form select, form textarea{width:100%;padding:12px 14px;border:1px solid var(--color-border);border-radius:8px}
    fieldset{border:1px solid var(--color-border);border-radius:12px;padding:16px;margin:16px 0}
    legend{padding:0 6px;font-weight:700}

    /* HERO (for confirm/login simple) */
    .hero-simple{padding:72px 0 32px}

    /* Usage meter */
    .meter{display:flex;gap:12px;align-items:center;margin:8px 0}
    .bar{flex:1;height:10px;background:#eee;border-radius:8px;overflow:hidden}
    .bar > span{display:block;height:100%;background:var(--color-accent);width:0}

    /* FOOTER */
    footer{padding:28px 0;text-align:center;color:#666;font-size:.9rem}

    @media (max-width: 960px){
      .grid-2{grid-template-columns:1fr}
    }
  </style>

</head>
<body>

    <nav class="nav container" aria-label="Top">
      <div class="logo"><a href="/index.html">Tradeautobill</a></div>
      <div class="row">
        <a href="/pricing.html" class="btn">Pricing</a>
        <a href="/account.html" class="btn">Account</a>
      </div>
    </nav>
    

  <section class="container py-10">
    <header class="row">
      <h1 style="margin:0">Create invoice</h1>
      <span class="pill" id="tier">Free</span>
    </header>
    
  <div class="meter" id="usage">
    <span class="tiny">Today: <strong id="dailyUsed">0</strong>/<span id="dailyLimit">0</span></span>
    <div class="bar"><span id="dailyBar" style="width:0%"></span></div>
    <span class="tiny">Month: <strong id="monthUsed">0</strong>/<span id="monthLimit">0</span></span>
  </div>


    <form id="invoiceForm">
      <fieldset>
        <legend>Business</legend>
        <input name="businessName" placeholder="Business name" required />
        <input name="businessEmail" type="email" placeholder="billing@you.co.uk" required />
        <input name="businessAddress" placeholder="Address" />
        <input name="vatNumber" placeholder="VAT number (optional)" />
      </fieldset>

      <fieldset>
        <legend>Customer</legend>
        <input name="customerName" placeholder="Customer name" required />
        <input name="customerEmail" type="email" placeholder="customer@their.com" required />
        <input name="customerAddress" placeholder="Address (optional)" />
      </fieldset>

      <fieldset>
        <legend>Invoice details</legend>
        <div class="grid-2">
          <input name="invoiceNumber" placeholder="INV-2025-0001" required />
          <input name="invoiceDate" type="date" required />
          <input name="dueDate" type="date" required />
          <input name="poNumber" placeholder="PO number (optional)" />
        </div>
        <textarea name="notes" placeholder="Notes (optional)"></textarea>
      </fieldset>

      <fieldset>
        <legend>Line items</legend>
        <table class="data" id="items">
          <thead><tr><th>Description</th><th>Qty</th><th>Unit £</th><th>VAT %</th><th class="num">Line £</th><th></th></tr></thead>
          <tbody id="itemRows"></tbody>
        </table>
        <button type="button" class="btn btn-secondary" id="addItem" style="margin-top:8px">Add item</button>
      </fieldset>

      <section class="card" id="totals">
        <div class="row" style="justify-content:space-between"><strong>Subtotal</strong><span id="subtotal">£0.00</span></div>
        <div class="row" style="justify-content:space-between"><strong>VAT</strong><span id="vat">£0.00</span></div>
        <div class="row" style="justify-content:space-between;font-size:1.25rem"><strong>Total</strong><span id="total">£0.00</span></div>
      </section>

      <div class="row" style="margin-top:12px">
        <button type="submit" class="btn btn-primary">Send invoice</button>
        <a class="btn btn-secondary" href="/pricing.html">Remove watermark & lift limits</a>
      </div>
    </form>
  </section>


    <footer>
      <div class="container">
        <p>© 2025 Tradeautobill. <a href="/privacy.html">Privacy</a> · <a href="/terms.html">Terms</a> · <a href="/faq.html">FAQ</a></p>
      </div>
    </footer>
    

<script>
  const rows = document.getElementById('itemRows');
  function money(n){ return '£' + (Math.round(n*100)/100).toFixed(2); }
  function recalc(){
    let sub=0, vat=0;
    rows.querySelectorAll('tr').forEach(tr=>{
      const qty = parseFloat(tr.querySelector('[data-qty]').value)||0;
      const unit = parseFloat(tr.querySelector('[data-unit]').value)||0;
      const rate = parseFloat(tr.querySelector('[data-vat]').value)||0;
      const line = qty*unit;
      const v = line*(rate/100);
      sub += line; vat += v;
      tr.querySelector('[data-line]').textContent = money(line+v);
    });
    document.getElementById('subtotal').textContent = money(sub);
    document.getElementById('vat').textContent = money(vat);
    document.getElementById('total').textContent = money(sub+vat);
  }
  function addRow(d='',q=1,u=0,vr=20){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input placeholder="Description" value="${d}"/></td>
      <td><input type="number" step="0.01" data-qty value="${q}"/></td>
      <td><input type="number" step="0.01" data-unit value="${u}"/></td>
      <td><input type="number" step="1" data-vat value="${vr}"/></td>
      <td class="num" data-line>£0.00</td>
      <td><button type="button" class="btn btn-link" data-del>Remove</button></td>`;
    rows.appendChild(tr);
    tr.querySelectorAll('input').forEach(i=>i.addEventListener('input', recalc));
    tr.querySelector('[data-del]').onclick = ()=>{ tr.remove(); recalc(); };
    recalc();
  }
  document.getElementById('addItem').onclick = ()=>addRow();
  addRow();

  document.getElementById('invoiceForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const form = e.target;
    const data = Object.fromEntries(new FormData(form).entries());
    const items = [...rows.querySelectorAll('tr')].map(tr=>({
      description: tr.children[0].querySelector('input').value,
      qty: parseFloat(tr.querySelector('[data-qty]').value)||0,
      unitPrice: parseFloat(tr.querySelector('[data-unit]').value)||0,
      vatRate: parseFloat(tr.querySelector('[data-vat]').value)||0
    }));
    const payload = {...data, items};
    const r = await fetch('/api/invoice',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(r.ok){ const {jobId}=await r.json(); location.href='/status.html?jobId='+encodeURIComponent(jobId); }
    else { alert('Failed to submit invoice.'); }
  });
</script>

<script>
  async function hydrateUsage(){
    try{
      const r = await fetch('/api/usage');
      if(!r.ok) return;
      const u = await r.json();
      document.getElementById('dailyUsed').textContent=u.dailyUsed;
      document.getElementById('dailyLimit').textContent=u.dailyLimit;
      document.getElementById('monthUsed').textContent=u.monthlyUsed;
      document.getElementById('monthLimit').textContent=u.monthlyLimit;
      const pct = Math.min(100, (u.dailyUsed/u.dailyLimit)*100 || 0);
      document.getElementById('dailyBar').style.width = pct + '%';
    }catch(e){}
  }
  hydrateUsage();
</script>

</body>
</html>